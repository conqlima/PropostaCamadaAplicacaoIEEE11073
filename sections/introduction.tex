\section{Introdução}\label{introduction}

%Wireless Sensor Networks (WSNs) can be applied to different scenarios, such as Internet of Things, Smart Cities, Medical Systems, etc. Due to increasing research efforts in WSN and telemedicine areas, a new type of network emerged: Wireless Body Area Networks (WBANs) or Body Area Networks (BANs) \cite{b21}. A WBAN consists of intelligent devices, attached to the skin or implanted in the body, capable of exchanging data over a wireless network \cite{b18}.
Redes de Sensores Sem Fio (RSSF) têm se tornado um ramo de estudo importante para inúmeros cenários de aplicação e simulação (internet das coisas, cidades inteligentes, informática médica, etc). Devido ao aumento de pesquisas na área de RSSF, juntamente com telemedicina, um novo tipo de rede surgiu: as redes corporais sem fio ou \textit{Wireless Body Area Networks} (WBANs) \cite{b21}. Uma WBAN é formada por dispositivos inteligentes colocados sobre pele ou implantados no corpo, que são capazes de trocar dados através de uma rede sem fio \cite{b18}. 

%The lack of commercial devices and health hazards make real experiments with WBANs rare. Therefore, simulation is an important tool to allow feasible tests with less cost and time. Castalia \cite{b15} is a widely used free and open source simulator for wireless sensor networks and wireless body area networks.
A ausência de dispositivos pessoais de saúde no mercado e os riscos que testes práticos podem oferecer à saúde tornam experimentos reais com WBANs complexos. Com o avanço e aperfeiçoamento de RSSF, simuladores se tornaram uma importante ferramenta que permite viabilizar testes com menor custo e tempo. O Castalia \cite{b15} é um simulador de redes de sensores sem fio, sensores corporais e dispositivos embutidos de baixa potência. Ele é um software livre e de código aberto, desenvolvido para que os usuários testem seus próprios algoritmos e protocolos.

%In Castalia, a body sensor is represented by a node that performs network functions, but the applications available in the simulator are generic, and do not specify the type sensor with its communication requirements.
O Castalia fornece uma estrutura genérica, confiável e realista para a primeira validação de um algoritmo, antes de passar para uma plataforma de sensor específica. Cada sensor é representado por um nó genérico, que executa funções de transmissão e recepção de dados. Entretanto, as aplicações disponíveis para testes de novos protocolos no simulador são genéricas, isto é, não especificam o tipo de sensor nem seus requisitos e procedimentos de comunicação na camada de aplicação. Isso representa um ponto fraco para o uso do simulador para aplicações de saúde digital, já que os protocolos de aplicação padronizados não são considerados nas simulações.

%In order to represent a more realistic simulation scenario, the use of a real standardized medical application is vital. The ISO/IEEE 11073 standard for Personal Health Devices (X73-PHD) describes data exchange, data representation, and terminology for communication between Personal Health Devices (PHD). Thus, this standard can be used as a role model for medical applications in our scenario.
Para tornar as simulações mais realistas, o uso de aplicações reais e padronizadas é um ponto vital. O padrão ISO/IEEE 11073 \textit{Personal Health Devices} (X73-PHD) descreve aplicações e informações para dispositivos de telessaúde. O padrão também especifica a troca e a representação de dados para comunicação entre dispositivos pessoais de saúde. Sendo assim, este artigo propõe o uso do padrão ISO/IEEE 11073 para simulação de aplicações de saúde digital em cenários de WBAN. Desta forma, simulações de novos protocolos em WBANs se tornam mais realistas com o uso de uma camada de aplicação baseada no padrão ISO/IEEE 11073.

%The term PHD involves both medical devices and health/fitness devices used in private homes \cite{b3}. The ISO/IEEE 11073 family of standards is divided into three groups, the first and oldest part is the ISO/IEEE 11073 \textit{Lower Layer}, which specifies protocols and communication service using physical layers such as infrared, wireless RF or Ethernet \cite{b16}. The ISO/IEEE 11073 \textit{Point-of-Care-Devices} (X73-PoC) specifies communication standards for devices that are used exclusively in health facilities. Finally, the X73-PHD, sets standards for personal devices used in private homes.
%VINICIUS - O que são "lay" users?, R: eu quis dizer usuários leigos mas já retirei essa palavra%
O termo PHD envolve tanto dispositivos médicos quanto dispositivos para exercícios físicos usados pelos próprios usuários em suas casas \cite{b3}. A família de normas ISO/IEEE 11073 é divida em três grupos, a primeira e mais antiga parte é a ISO/IEEE 11073 \textit{Lower Layer}, que especifica protocolos e serviços de comunicação orientados à conexão, utilizando camadas físicas como infravermelho, tecnologia RF sem fio ou Ethernet \cite{b16}. Já a parte ISO/IEEE 11073 \textit{Point-of-Care-Devices} especifica normas de comunicação para dispositivos que são usados exclusivamente em unidades de saúde. Por fim, a ISO/IEEE 11073 \textit{Personal Health Devices} (PHD), ou Dispositivo Pessoal de Saúde (DPS), define normas para dispositivos usados pelos usuários em suas casas. O foco deste trabalho será apenas na norma ISO/IEEE 11073 \textit{Personal Health Devices}, que especifica dispositivos usados mais frequentemente por usuários comuns, tais como pacientes em suas casas ou atletas que precisam ter sua atividade física monitorada, representando uma parte significativa das aplicações de saúde digital. Por questões de simplificação, esta norma será referenciada apenas como X73-PHD neste texto.

%The X73-PHD standard defines two types of devices: Agents and Managers. Agents are typically low power sensors or actuators, with limited processing power, whereas managers are devices with a greater processing power, that could be connected to an energy source.
A norma X73-PHD define dois tipos de dispositivos: \emph{agentes} e \emph{gerentes}. Os agentes são tipicamente sensores ou atuadores, de baixa potência e com pouco poder de processamento, enquanto os gerentes são dispositivos com um poder de processamento maior, que podem ou não estar conectados a uma fonte de energia. Apesar da norma X73-PHD não comentar explicitamente, dispositivos agentes e gerentes poderiam ser nós de uma WBAN.
%The goal of this work is to propose the use of ISO/IEEE 11073 standard in e-health network simulations, representing realistic medical applications and investigating the behavior of medical devices (sensors or actuators) in WBAN scenarios. Examples of personal health devices are oximeters, thermometers, ECGs, glucose meters, blood pressure monitors, etc.
%O objetivo deste trabalho, portanto, é propor uma sub-camada de aplicações médicas para o simulador Castalia, que simulará o dispositivo médico (sensor ou atuador) e analisar o comportamento desses dispositivos em redes WBAN. Alguns exemplos de dispositivos agentes simulados em redes WBAN são, termômetro, monitor de pressão sanguı́nea, medidor de glicose e etc. Todas as extensões serão desenvolvidas de acordo com a padronização de comunicação de dispositivos pessoais de saúde definidos pela norma X73-PHD.
%This paper proposes a free and open-source implementation of Personal Health Devices (PHD)  for  Castalia  Simulator.  We  implemented  five  different PHDs   to   act   like   real   ISO/IEEE   11073   devices   in   WBAN  simulations using the Antidote Library \cite{b20} as a basis.  Our  implementation also supports   a   confirmed   communication   mode,   where the receiver  sends  an  acknowledgement  to  the  sender  every  time it receives  a  packet. The 11073 standard was created as an application layer relying on reliable transport layer services. However, in many WSNs and WBAN scenarios, the transport layer is absent. Therefore, the protocol's reliable data transfer mechanism had to be adjusted to the dynamics of a faulty wireless channel, and the lack of transport layer services. Thus, we  propose  an  extension  to  the  standard  that  decreases  the overhead  of  control  packets  over  the  network.
Existem dois modos de comunicação na norma X73-PHD, o modo com confirmação e sem confirmação. No modo sem confirmação, as leituras são transmitidas sem nenhum tipo de confirmação de recebimento por parte do gerente. O modo com confirmação espera que, para cada pacote de leitura enviado pelos agentes, um \textit{acknowledgement} (ACK) seja transmitido, reconhecendo que o pacote foi entregue no gerente. De acordo com o padrão, caso o agente não receba o ACK num período de 3s, uma nova associação com o gerente deve ser feita para finalizar a transmissão de leituras. 

Este último modo de comunicação pode aumentar consideravelmente o número de pacotes de controle trocados entre agente e gerente em um cenário WBAN, quando um ACK é perdido. Para evitar esse \textit{overhead}, este artigo também propõe um novo modo de comunicação, chamado \textit{modo de retransmissão}. Este modo é baseado em \textit{stop-and-wait}, que retransmite o pacote perdido, ao invés de solicitar imediatamente uma nova associação. 

%The rest of the paper is organized as follows: In Section \ref{relatedworks}, we present related works, focusing on X73-PHD works. In Section \ref{systemarch}, an overview of our proposal is given. In Section \ref{castaliaapplayer}, we discuss the parameters available for the user to configure his/her simulation. Results are given in Section \ref{results} and, finally, conclusions in Section \ref{conclusion}.
O restante do artigo está estruturado da seguinte forma. Na Seção \ref{relatedworks}, apresentam-se trabalhos relacionados sobre o padrão X73-PHD. 
%Já na Seção \ref{systemarch}, mostramos uma visão geral do simulador e da adaptação feita na biblioteca Antidote. 
A Seção \ref{castaliaapplayer} apresenta a proposta deste artigo, detalhando o novo modo de comunicação proposto como uma extensão ao padrão X73-PHD. 
Resultados de simulações com o Castalia são discutidos na Seção \ref{results}. Por fim, as considerações finais e trabalhos futuros são comentados na Seção \ref{conclusion}.
